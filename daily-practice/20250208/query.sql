問題：以下の分析を行うクエリを作成してください。

1. 各カテゴリー（親カテゴリーを含む）の売上集計を行い、以下の情報を表示してください：
   - カテゴリー名
   - 総売上金額
   - 平均注文単価
   - カスタマイズされた注文の割合（パーセンテージ）
   - そのカテゴリーで最も人気のある素材（attributesのmaterial）
   - 会員ランク別の購入比率（JSON形式で出力）

2. 以下の条件で商品のレコメンデーションリストを作成してください：
   - 各顧客の好みの素材（preferences）と一致する商品
   - まだ購入していない商品のみ
   - 会員ランクに応じた価格帯の商品（PLATINUM: 上限なし、GOLD: 20万円まで、SILVER: 10万円まで）
   - 商品の利用可能サイズ（sizes_available）が複数ある商品を優先
   - カスタマイズ可能な商品（customizationが存在する注文がある商品）を優先
