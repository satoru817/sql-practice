問題：
以下の分析を行うSQLクエリを作成してください。

1. 各カテゴリ（親カテゴリを含む）における以下の情報を抽出してください：
   - カテゴリ名
   - 総売上額
   - 平均利益率
   - 最も人気のある商品仕様（specs内の情報で最も売れている組み合わせ）
   - レビューの平均評価（review_details内の各評価項目の平均）
   - 配送方法ごとの注文数（delivery_info内の配送方法の分布）

このクエリでは以下のような技術的チャレンジがあります：
- JSONデータの解析と集計
- 階層的なカテゴリ構造の処理
- 複数テーブルの結合と集計
- Window関数の活用
- 複雑な条件での集計

回答する際は、以下のポイントを意識してください：
- パフォーマンスを考慮したクエリ設計
- JSONデータの適切な処理
- NULL値の適切な処理
- 集計結果の可読性
