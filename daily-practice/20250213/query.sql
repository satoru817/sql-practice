以下の分析を行うSQLを作成してください：

1. 各医師の専門分野に「消化器科」を含む医師の、2024年1月の診療件数と、処方した薬剤の種類数を求めてください。

2. 内科系の診療（primaryが"内科"で始まる）について、患者の年代別（10代、20代...）の診療件数と、最も多く処方された薬剤TOP3を抽出してください。その際、処方箋が存在しない診療も件数には含めてください。

3. 過去に「高血圧」の既往歴がある患者の、直近3回の診療記録について、診断名と処方薬をリスト形式で取得してください。

期待される実装のポイント：
- JSON操作の適切な使用
- 結合の最適化（INNER/LEFT JOINの使い分け）
- CTEを使用した段階的な処理
- 集計と順位付けの組み合わせ
- NULL値の適切な処理

なお、上記のテーブルはすでにデータが入っており、各カラムのNULL制約や一意性制約は適切に設定されているものとします。

このクエリを実装することで、JSON処理、複数テーブルの結合、Window関数の使用など、これまでの学習内容を総合的に活用することができます。
